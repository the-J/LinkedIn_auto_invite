// ==UserScript==
// @name             LinkedIn - Auto Invite Mching Your Filter
// @match            https://www.linkedin.com/search/results/people/*
// @author           the-j <the-j@users.noreply.github.com>
// @version          1.0.0
// @icon             data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAABVDAAAVQwGX9qBSAAAAB3RJTUUH4wETEjIqCqH49AAABb5JREFUeNrtm1tsFFUYx3/nzO7stttuW7aWlgZarikICCaCXEIgEWNAXk0MPoG3KImQgL6IGhIffCDxxXiBmJjAg1FjEBIhGhOCRDByEUqDIqUtLIXSy/ay7e7szhwfWrGEdmcKlTOL/T/OnvPN9/32nDPfd+aMkNsPAkjgGWATMB8I8HAqA9QDnwNHACcAGMAW4B1gkm4PH4DqgDXALuCjAPAs8C5QptuzB6gY8B7QLIHN/7Pg/1EZsFkCc3V7olFzJRDU7YVGBaVuD3Trnh53jlIACARC6A7hAQJwHEXYNJhcFCIckHSnstxKprEdhcxTEp4AKCAgBRvmTWbTkqksqIoSDhp09Vscbezk01+a+f16d15C8AQgKAXbVs3g7admUxT6t0tVcYh5k4tZO7ucLd/Wc+SPtryD4LoIOo5iw7zJ7Fw7547gh2tWeYTdG+YxKxa5vT7ki3ICUEAkFODFJ2uImEZOQ49WFvPcoim64xlnAEpRXRJmYWWxJ2PLaycRDhie2vpFuaeAgohpUBD0FlRpQYCgIcinSZAbgIDugSw96awnY219FumsQz4tgzkBSCGI96T49WrCk7GfLrVjZR3dMY0fAIB0xubj40209aVztjvW2Mk351rJt9TQFYCUgqONHWw/2MC17tSIbY43dfLGgXpae1PI/Irfeyq873Schpt9bHy8miemllJkGtzoTfPDpXa+PBsn3p3KuyRoTAAEcOpagtPxbopMA9OQ9GdsBiwbhMjL4McEALgdZJ9lg7IRYnCK5LM8F0NqhBR3+KVcpbFSoHJkByP1VYByhspuITCkQAC2UoPp9pA5MXT9PwUQMQ1Kwzk2jgTYjqIjaZF17gw0IAWxiIkhBSMyEGDbivZ+C3uor+MoCk2D+ZVRlkwrpa6iiPIhG/2Wzc2+NH/eSnIm3s3Ftj6S6ew9g3AF4DiK9XUVvL+ujtHqHCkErb0pXth/hqau/ttTxVGKKdEC9m1cTFVxeMRCSQpBS2KAjftPc707RdCQrK17hNeW17ByeoxJhaOD7+i3ONmcYM/JFr6/2IaVdcb8FPY0AkrCQWbGIjnbFAQlQePuuwcNwYxJhVRFw6P2NeTgEC8OB3hrzSy2rJxOSdjdtVihybq5FayeGeOzE83s+uESXQOZMT2KPa8BbnLUvf0Gg9MnYhrsWD2TLSumj/lfLDQNtq6agRmQ7DjUwEDGezrui01RIWDz0mm8sqzmvhLJl5ZO4/lF1SMu2L4GMCUa5tVltZjG/bkTNCSvr6ilKhp2HXW+AhAKSIrM8dlHWFgVZc2scvA4CnwBYDxlSMHTc8oxDG9zyZevwa8lUpyKJ7iaSKGUoraskKU1pVQUhTz1f2xKCWUFJh1Jy3VN8RUA21F88ds1dh+9zF/tSSx7cG8hFJAsri7hg/VzWTUj5mqnOhqmsjhEezKNW3rkqynw9blWth2op+FGL9mhly1SCDK24sSVLrYeuEBLYsDVTlHIoLI45On57RsAHf0WHx5rpCeVHbHAkobg7PUevrtw09VWKCCJRUxP9/UNgLPxHs639iJypHHKUfx8pfN2zTBqUEIQ9ZBJ+grA+Ru9JK2sawbX3NVP0rJd7YUD3kLzDYB4YsB9zgroSWUZyLgDMDwWBL4B4HXrPWM7d5XcIwLwmFP7BkDW1vM6xTcAdGkCgG4HdGsCgG4HdGsCgG4HdGsCgG4HdGsCgG4HdGsCgG4HdMs/ADQdM3DfNxJw7EoHL391LmezpJWlrc9CDKvDhRC09Vm8eaiBiJn7VsevdLpC8GpPACdaujwd2BJy+8EmoCZXo+EHEnIbu3sTevhBB5foPL3V9W4PL8d2mj3tHEoh7nmIiiEw46XxtuefNUCTJgAAlm4nNMqSwAXdXmhUvQT2AB26PdGgDmCvBA4z+OF0u26PHqBuATuBwwHAAT4BLjP4HfECHt6vSTPAeWAv8CPg/A1tW9Qcor3o+QAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0wMS0xOVQxNzo1MDo0MiswMTowMGNvaxAAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMDEtMTlUMTc6NTA6NDIrMDE6MDASMtOsAAAAAElFTkSuQmCC
// ==/UserScript==

(function () {
    'use strict'

    // DEV
    const DEV_MODE = false
    const AUTO_RUN = false // for development

    // SETTINGS
    const DEFAULT_TIMEOUT = 2000

    // DONT'T TOUCH
    let DONT_REPEAT_YOU_TRASH = true
    let PAGE_LOADED = false
    let INVITES_SEND_COUNTER = 0


    //******************************
    //******************************
    //******************************
    //******************************
    //******************************
    //******************************

    function createConnectButton() {
        const connectButtonContainer = document.createElement('div')
        connectButtonContainer.innerHTML = '<a id="startScriptBtn">Start connecting!</a>'
        connectButtonContainer.style.display = 'inline-block'
        connectButtonContainer.style.position = 'fixed'
        connectButtonContainer.style.left = '3em'
        connectButtonContainer.style.top = '8em'
        connectButtonContainer.style.zIndex = '995'
        connectButtonContainer.style.cursor = 'pointer'
        document.body.append(connectButtonContainer)

        const startScriptBtn = document.getElementById('startScriptBtn')
        startScriptBtn.style.background = 'red'
        startScriptBtn.style.color = 'blue'
        startScriptBtn.style.fontWeight = '800'
        startScriptBtn.style.padding = '5px'
        startScriptBtn.style.border = 'solid 2px black'
        startScriptBtn.style.borderRadius = '7px'
        startScriptBtn.style.textDecoration = 'none'
        startScriptBtn.style.fontSize = '0.8em'

        document
            .getElementById('startScriptBtn')
            .addEventListener('click', runScript, false)
    }

    function createFunctionalityInfoPopup() {
        const infoModalContainer = document.createElement('div')
        infoModalContainer.innerHTML = '<a id="infoModalBtn">Works on the list of people (filtered or not):<br/> https://www.linkedin.com/search/results/people/*</a>'
        infoModalContainer.style.display = 'none'
        infoModalContainer.style.position = 'fixed'
        infoModalContainer.style.left = '3em'
        infoModalContainer.style.top = '12em'
        infoModalContainer.style.zIndex = '996'
        infoModalContainer.style.cursor = 'pointer'
        document.body.append(infoModalContainer)

        const infoModalBtn = document.getElementById('infoModalBtn')
        infoModalBtn.style.background = 'palevioletred'
        infoModalBtn.style.color = 'white'
        infoModalBtn.style.marginTop = '0.5em'
        infoModalBtn.style.padding = '4px'
        infoModalBtn.style.borderRadius = '7px'
        infoModalBtn.style.textDecoration = 'none'
        infoModalBtn.style.fontSize = '1em'
    }

    function craeteCounter() {
        const counter = document.createElement('div')
        counter.innerHTML = '<p id="counter">Invites send counter: ' + INVITES_SEND_COUNTER + '</p>'
        counter.style.display = 'inline-block'
        counter.style.position = 'fixed'
        counter.style.left = '15em'
        counter.style.top = '8em'
        counter.style.zIndex = '995'
        counter.style.cursor = 'pointer'
        counter.style.color = 'blue'
        counter.style.fontWeight = '800'
        counter.style.padding = '5px'
        counter.style.border = 'solid 2px black'
        counter.style.borderRadius = '7px'
        counter.style.textDecoration = 'none'
        counter.style.fontSize = '0.8em'
        counter.style.background = 'red'
        document.body.append(counter)
    }

    function checkIfPageLoaded() {window.addEventListener('load', setPageLoadedTrue())}

    function setPageLoadedTrue() {
        DEV_MODE && console.log('PAGE_LOADED: ', PAGE_LOADED)
        PAGE_LOADED = true
    }

    function pauseScript( scriptPauseFor = DEFAULT_TIMEOUT ) {return new Promise(res => setTimeout(res, scriptPauseFor))}

    function scrollToBottom() {window.scroll({ top: document.body.scrollHeight, left: 0, behavior: 'smooth' })}

    function findNextPageButton() {return document.getElementsByClassName('artdeco-pagination__button--next')[ 0 ]}

    function findSendNowButton() {return document.getElementsByClassName('ml1')[ 0 ]}

    function findConnectButtons() {
        const findAllButtons = document.getElementsByClassName('artdeco-button')
        const connectActionButtons = []
        Object.keys(findAllButtons).map(buttonKey => {
            const button = findAllButtons[ buttonKey ]
            if (button.textContent.includes('Connect')) {
                connectActionButtons.push(button)
            }
        })
        return connectActionButtons
    }

    function gotoNextPage() {
        DEV_MODE && console.log('gotoNextPage')
        findNextPageButton().click()
    }

    async function sendInvites( buttonsList ) {
        DEV_MODE && console.log('sendInvites', buttonsList.length)
        for (const button of buttonsList) {
            button.click()
            findSendNowButton().click()
            INVITES_SEND_COUNTER++
            await pauseScript(500)
        }
        craeteCounter()
    }

    async function startSendingInvites() {
        DEV_MODE && console.log('startSendingInvites')
        const userConnectButtons = findConnectButtons()
        if (userConnectButtons.length) {
            await sendInvites(userConnectButtons)
        }
        gotoNextPage()
        return startInvitingPeople()
    }

    async function startInvitingPeople() {
        DEV_MODE && console.log('startInvitingPeople')
        scrollToBottom()
        await pauseScript()
        return startSendingInvites()
    }

    async function checkRequirements() {
        DEV_MODE && console.log('checkRequirements')
        const doesLocationIncludePeople = location.pathname.includes('people')

        if (doesLocationIncludePeople) {
            DEV_MODE && console.log('requirements ok')
            return startInvitingPeople()
        }

        const infoModalBtn = document.getElementById('infoModalBtn').parentNode
        infoModalBtn.style.display = 'block'
        await pauseScript(4000)
        infoModalBtn.style.display = 'none'
    }

    async function runScript() {
        DEV_MODE && console.log('runScript')

        if (!PAGE_LOADED) {
            DEV_MODE && console.log('page not loaded - restart')
            await pauseScript(4000)
            return runScript()

        }
        window.removeEventListener('load', setPageLoadedTrue())
        return checkRequirements()

    }

    if (window.self == window.top) {
        createConnectButton()
        createFunctionalityInfoPopup()
        checkIfPageLoaded()
        craeteCounter()
    }

    if (AUTO_RUN && DONT_REPEAT_YOU_TRASH) {
        DEV_MODE && console.log('AUTO_RUN: ', AUTO_RUN)
        DONT_REPEAT_YOU_TRASH = false
        return runScript()
    }
})()









